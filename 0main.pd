#N canvas 165 30 740 427 12;
#X declare -path Fraise_abs;
#X obj 14 208 cnv 20 90 140 empty empty HOMING 20 12 0 14 #e0e0e0 #404040 0;
#X obj 113 209 cnv 20 300 140 empty empty POSITION 20 12 0 14 #e0e0e0 #404040 0;
#X obj 419 210 cnv 20 300 140 empty empty SPEED 20 12 0 12 #e0e0e0 #404040 0;
#X obj 25 46 wifruit fruit1 192.168.11.2;
#X obj 16 385 fruit/send fruit1;
#X obj 24 5 declare -path Fraise_abs;
#X obj 124 297 hsl 170 20 0 33165 0 0 empty empty ramp_destination 5 10 0 12 #fcfcfc #7c7c7c #000000 0 1;
#X floatatom 300 322 12 0 0 0 - - - 0;
#X text 178 325 ramp destination;
#N canvas 393 79 1197 844 debug 1;
#X obj 6 8 cnv 20 150 250 empty empty STATS 20 12 0 12 #e0e0e0 #404040 0;
#X obj 163 8 cnv 20 750 250 empty empty SETTINGS 20 12 0 12 #e0e0e0 #404040 0;
#X obj 924 9 cnv 20 250 250 empty empty DEBUG\ (don't\ use...) 20 12 0 12 #e0e0e0 #404040 0;
#X obj 162 264 cnv 20 750 250 empty empty RETURN\ INFOS 20 12 0 12 #e0e0e0 #404040 0;
#X obj 973 137 tgl 20 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 977 194 hsl 170 20 0 29480 0 0 empty empty empty -2 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X floatatom 1036 195 12 0 0 0 - - - 0;
#X text 1033 225 PID setPoint;
#X text 1026 162 enable motor control;
#X obj 15 42 tgl 20 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X text 63 108 get pwm;
#X text 62 164 get encoder;
#X text 62 195 get ramp pos;
#X obj 14 229 t a;
#X obj 929 233 t a;
#X obj 175 291 fruit/receive fruit1;
#X listbox 175 367 40 0 0 3 VERSION - VERSION 0;
#X obj 175 342 list;
#X obj 569 355 print from_fruit;
#X obj 230 342 tgl 20 0 empty empty empty 0 -10 0 12 #000000 #ff0400 #000000 0 1;
#X obj 285 342 tgl 20 0 empty empty empty 0 -10 0 12 #000000 #ff0400 #000000 0 1;
#X floatatom 508 438 8 0 0 3 PWM - PWM 0;
#X obj 508 355 route l;
#X floatatom 713 439 12 0 0 3 ramp_pos - ramp_pos 0;
#X obj 782 382 print log_fruit;
#X listbox 259 427 8 0 0 0 STATE - STATE 16;
#X obj 259 402 symbol;
#X obj 570 412 unpack f f;
#X floatatom 570 437 9 0 0 3 enc_count - current_position 0;
#X floatatom 639 437 9 0 0 3 enc_speed - - 0;
#X obj 292 91 hsl 170 20 -1 1 0 0 empty empty empty -2 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X obj 289 116 * 32767;
#X floatatom 358 115 5 0 0 0 - - - 0;
#X msg 289 67 0;
#X text 357 142 pwm[-32767-32767];
#X msg 347 63 -20000;
#X msg 403 58 20000;
#X msg 468 64 -5000;
#X obj 385 399 sel 1;
#X msg 385 424 V;
#X obj 185 491 fruit/send fruit1, f 29;
#X text 522 234 kp ki kd (*1000);
#X floatatom 525 60 5 0 0 2 kp - - 0;
#X floatatom 576 60 5 0 0 2 ki - - 0;
#X floatatom 627 60 5 0 0 2 kd - - 0;
#X obj 576 84 t b f;
#X obj 627 83 t b f;
#X obj 525 138 unpack f f f, f 15;
#X obj 525 163 * 1000;
#X obj 576 163 * 1000;
#X obj 627 163 * 1000;
#X obj 525 188 pack f f f, f 15;
#X obj 525 113 pack 370 650 0.1;
#X floatatom 958 429 12 0 0 0 - - - 0;
#X msg 958 308 44 670;
#X obj 958 333 *;
#X floatatom 958 358 5 0 0 0 - - - 0;
#X text 955 271 encoder: 44 step/tr;
#X text 955 287 reduction: 670;
#X obj 289 236 t a;
#X obj 958 453 * 270;
#X obj 958 478 / 360;
#X floatatom 958 503 5 0 0 0 - - - 0;
#X text 62 136 get current;
#X obj 15 67 metro 100;
#X obj 508 380 route pwm m ramp current, f 37;
#X floatatom 808 469 12 0 0 3 current(mA) - - 0;
#X msg 32 107 1;
#X msg 31 135 2;
#X msg 31 163 3;
#X msg 28 193 4;
#X msg 289 143 100 i \$1;
#X msg 525 214 110 l \$1 \$2 \$3;
#X msg 972 108 210 l 0;
#X text 1027 107 set encoder count;
#X msg 973 164 220 \$1;
#X msg 974 224 230 l \$1;
#X obj 167 52 tgl 20 0 empty empty unlock_settings 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X msg 167 77 20 \$1;
#X text 287 33 Manual PWM;
#X text 522 28 PID;
#X text 705 27 RAMP;
#X text 412 414 get version, f 7;
#X obj 971 54 tgl 20 0 empty empty unlock_debug 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X msg 971 79 200 \$1;
#X obj 808 411 - 120;
#X obj 808 440 max 0;
#X text 187 52 (be cautious!);
#X obj 83 16 inlet;
#X msg 703 89 120 l 1000;
#X msg 702 117 120 l 100;
#X text 701 148 WARNING: you should wait the motor is stopped \, before changing the acceleration factor., f 29;
#X text 700 53 acceleration factor (steps/sec²), f 20;
#X obj 958 381 * 30;
#X obj 958 404 / 20;
#X text 991 385 additional wheel-belt reduction, f 23;
#X text 1048 429 44220 steps/tour;
#X text 1000 504 33165 steps/270°;
#X obj 328 554 r ramp_pos;
#X obj 328 579 change;
#X obj 299 686 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 328 604 > 0;
#X obj 328 629 change;
#X obj 328 654 sel 1;
#X obj 398 629 change;
#X obj 398 654 sel 1;
#X obj 343 705 timer;
#X floatatom 343 760 17 0 0 0 - - - 0;
#X obj 343 733 / 1000;
#X obj 398 605 > 33164;
#X obj 451 717 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 80 581 route 120;
#X obj 80 606 route l;
#X obj 17 556 r ramp_maxspeed;
#X obj 80 631 t b f;
#X obj 17 681 expr $f1/$f2 + 33165/$f1;
#X floatatom 30 706 5 0 0 0 - - - 0;
#X obj 17 730 s estim-270-time;
#X obj 17 656 pack 5400 2000;
#X text 998 358 29480 steps/motor_tour;
#X text 13 754 T = maxspeed/accel + distance/maxspeed;
#X obj 175 316 route V end_low end_high state present e;
#X obj 464 490 print error_fruit;
#X floatatom 805 566 9 0 0 0 - - - 0;
#X obj 660 571 / 1000;
#X obj 628 637 mapping/timeroll;
#X connect 4 0 75 0;
#X connect 5 0 76 0;
#X connect 5 0 6 0;
#X connect 9 0 64 0;
#X connect 13 0 40 0;
#X connect 13 0 111 0;
#X connect 14 0 40 0;
#X connect 15 0 121 0;
#X connect 17 0 16 0;
#X connect 22 0 65 0;
#X connect 22 1 18 0;
#X connect 26 0 25 0;
#X connect 27 0 28 0;
#X connect 27 1 29 0;
#X connect 30 0 31 0;
#X connect 31 0 32 0;
#X connect 31 0 71 0;
#X connect 33 0 30 0;
#X connect 35 0 30 0;
#X connect 36 0 30 0;
#X connect 37 0 30 0;
#X connect 38 0 39 0;
#X connect 39 0 40 1;
#X connect 42 0 52 0;
#X connect 43 0 45 0;
#X connect 44 0 46 0;
#X connect 45 0 52 0;
#X connect 45 1 52 1;
#X connect 46 0 52 0;
#X connect 46 1 52 2;
#X connect 47 0 48 0;
#X connect 47 1 49 0;
#X connect 47 2 50 0;
#X connect 48 0 51 0;
#X connect 49 0 51 1;
#X connect 50 0 51 2;
#X connect 51 0 72 0;
#X connect 52 0 47 0;
#X connect 53 0 60 0;
#X connect 54 0 55 0;
#X connect 55 0 56 0;
#X connect 56 0 93 0;
#X connect 59 0 13 0;
#X connect 60 0 61 0;
#X connect 61 0 62 0;
#X connect 64 0 67 0;
#X connect 64 0 69 0;
#X connect 64 0 70 0;
#X connect 64 0 68 0;
#X connect 65 0 21 0;
#X connect 65 1 27 0;
#X connect 65 2 23 0;
#X connect 65 3 85 0;
#X connect 65 3 123 0;
#X connect 65 3 124 0;
#X connect 65 4 24 0;
#X connect 67 0 13 0;
#X connect 68 0 13 0;
#X connect 69 0 13 0;
#X connect 70 0 13 0;
#X connect 71 0 59 0;
#X connect 72 0 59 0;
#X connect 73 0 14 0;
#X connect 75 0 14 0;
#X connect 76 0 14 0;
#X connect 77 0 78 0;
#X connect 78 0 59 0;
#X connect 83 0 84 0;
#X connect 84 0 14 0;
#X connect 85 0 86 0;
#X connect 86 0 66 0;
#X connect 88 0 9 0;
#X connect 89 0 59 0;
#X connect 90 0 59 0;
#X connect 93 0 94 0;
#X connect 94 0 53 0;
#X connect 98 0 99 0;
#X connect 99 0 101 0;
#X connect 99 0 109 0;
#X connect 101 0 102 0;
#X connect 102 0 103 0;
#X connect 103 0 100 0;
#X connect 103 0 106 0;
#X connect 104 0 105 0;
#X connect 105 0 106 1;
#X connect 105 0 110 0;
#X connect 106 0 108 0;
#X connect 108 0 107 0;
#X connect 109 0 104 0;
#X connect 111 0 112 0;
#X connect 112 0 114 0;
#X connect 113 0 118 0;
#X connect 114 0 118 0;
#X connect 114 1 118 1;
#X connect 115 0 116 0;
#X connect 115 0 117 0;
#X connect 118 0 115 0;
#X connect 121 0 17 0;
#X connect 121 1 19 0;
#X connect 121 2 20 0;
#X connect 121 3 26 0;
#X connect 121 4 38 0;
#X connect 121 5 122 0;
#X connect 121 6 22 0;
#X connect 124 0 125 0;
#X restore 22 178 pd debug;
#X listbox 97 95 34 0 0 0 VERSION VERSION - 16;
#X listbox 97 122 13 0 0 0 STATE STATE - 16;
#X msg 16 256 10;
#X msg 121 323 11 l \$1;
#X obj 124 248 hsl 170 40 0 44220 0 0 --- --- empty -2 -10 0 12 #ffffff #ffffff #000000 0 1;
#X obj 124 248 hsl 170 20 0 33165 0 0 empty ramp_pos ramp_current_pos 5 10 0 12 #9f9f9f #000000 #ffffff 0 1;
#X obj 124 269 hsl 170 20 0 33165 0 0 empty current_position current_position 5 10 0 12 #9f9f9f #000000 #ffffff 0 1;
#X obj 22 154 tgl 20 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000 0 1;
#X floatatom 94 163 8 0 0 3 PWM PWM - 0;
#X obj 429 295 hsl 170 20 0 5400 0 0 ramp_maxspeed empty ramp_maxspeed 5 10 0 12 #fcfcfc #7c7c7c #000000 0 1;
#X text 423 245 ramp maxspeed (steps/sec);
#X text 425 263 Max value for this motor: 5400 steps/sec;
#X msg 426 321 12 l \$1;
#X floatatom 491 322 9 0 0 0 - - - 0;
#X text 302 296 33165 = 270°;
#X obj 609 368 nbx 5 18 -1e+37 1e+37 0 0 empty estim-270-time empty 0 -10 0 12 #fcfcfc #000000 #000000 0 256;
#X text 421 368 Estimated 270° time (sec):;
#X obj 187 159 bng 20 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X connect 6 0 13 0;
#X connect 6 0 7 0;
#X connect 11 0 27 0;
#X connect 12 0 4 0;
#X connect 13 0 4 0;
#X connect 17 0 9 0;
#X connect 19 0 22 0;
#X connect 19 0 23 0;
#X connect 22 0 4 0;
